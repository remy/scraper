<!doctype html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <title>Scraper Scripts</title>
    <base href="<%= baseHref %>" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.css" />
    <link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/theme/material-darker.min.css" />
  </head>

  <body>
    <h1>Scraper Scripts</h1>
    <% if (message) { %>
      <p class="message">
        <%= escapeHtml(message) %>
      </p>
      <% } %>

        <div class="mode-toggle">
          <button type="button" class="mode-button active" data-mode="endpoints">Endpoints</button>
          <button type="button" class="mode-button" data-mode="editor">Editor</button>
        </div>

        <section class="panel" id="endpointsView">
          <h2>Available endpoints</h2>
          <p class="note">Call, edit, or manage your scripts from one view.</p>
          <form class="upload-inline" action="upload-file" method="post" enctype="multipart/form-data">
            <label for="endpointScriptFile">Upload script file (.mjs, .js, etc.)</label>
            <input type="file" id="endpointScriptFile" name="scriptFile" required />

            <label for="endpointScriptName">Override name (optional)</label>
            <input type="text" id="endpointScriptName" name="scriptName" placeholder="my-script" />

            <button type="submit">Upload File</button>
          </form>
          <ul class="script-list" id="endpointList" data-api-base="<%= apiBasePath %>">
            <li>Loading scripts...</li>
          </ul>
        </section>

        <div class="modal hidden" id="confirmModal" role="dialog" aria-modal="true">
          <div class="modal-content">
            <h3 id="confirmTitle">Confirm deletion</h3>
            <p id="confirmMessage">Are you sure?</p>
            <div class="modal-actions">
              <button type="button" class="secondary" id="cancelDeleteBtn">Cancel</button>
              <button type="button" class="danger" id="confirmDeleteBtn">Delete</button>
            </div>
          </div>
        </div>

        <div class="modal hidden" id="renameModal" role="dialog" aria-modal="true">
          <div class="modal-content">
            <h3 id="renameTitle">Rename script</h3>
            <p id="renameMessage">Update the file name (without extension).</p>
            <label for="renameInput">New name</label>
            <input type="text" id="renameInput" autocomplete="off" />
            <div class="modal-actions">
              <button type="button" class="secondary" id="cancelRenameBtn">Cancel</button>
              <button type="button" id="confirmRenameBtn">Rename</button>
            </div>
          </div>
        </div>

        <section class="panel editor-panel hidden" id="editorView">
          <h2>Create or Edit Script</h2>
          <form id="textScriptForm" action="upload-text" method="post">
            <label for="textScriptName">Script name</label>
            <input type="text" id="textScriptName" name="scriptName" placeholder="my-script" required />

            <label for="scriptContent">Content</label>
            <textarea id="scriptContent" name="scriptContent" rows="14" placeholder="// Paste your script or data here"
              required></textarea>

            <div class="editor-actions">
              <button type="button" id="templateBtn" class="secondary">Insert template</button>
              <button type="button" id="newScriptBtn" class="secondary">New script</button>
              <button type="submit" id="saveScriptBtn">Save script</button>
            </div>
            <p class="status" id="statusMessage"></p>
            <p class="note">
              Tip: This editor is great for quick tweaks, but editing files via
              Samba/SSH at
              <code>/addon_configs/&lt;repository&gt;_scraper/scripts</code>
              gives you better tooling support. All scripts are saved with a
              <code>.mjs</code> extension.
            </p>
          </form>

        </section>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/codemirror.min.js"></script>
        <script
          src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/mode/javascript/javascript.min.js"></script>
        <script
          src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.15/addon/edit/closebrackets.min.js"></script>
        <script type="template" id="templateScript">
            <%- scriptTemplate %>
        </script>
        <script src="js/app.js" defer></script>
  </body>

</html>